kind: pipeline
type: docker
name: default

platform:
  os: linux
  arch: amd64

steps:
#  - name: build
#    image: gradle:6.6.1-jdk14
#    pull: true
#    environment:
#      GRADLE_USER_HOME: tmp/cache
#    commands:
#      - ./gradlew clean
#      - ./gradlew kotlinDemo:build -x test
#    when:
#      event: [push]
#      status:
#        - success

#  - name: 배포
#    image: drone-example:${DRONE_COMMIT_SHA}
#

#  - name: build
#    image: plugins/docker
#    settings:
#      repo: anstnsp/drone_test
#      username:
#        from_secret: docker_username
#      password:
#        from_secret: docker_password

  - name: 슬랙 알림
    image: plugins/slack
    settings:
      webhook: https://hooks.slack.com/services/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
      channel: 드론테스트용
      template: >
        *{{#success build.status}}✔{{ else }}✘{{/success}} {{ uppercasefirst build.status }}: Deploy* (type: `{{ build.event }}`)
        Repo: <https://github.com/{{ repo.owner }}/{{ repo.name }}|{{ repo.name }}>
        Commit: <https://github.com/{{ repo.owner }}/{{ repo.name }}/commit/{{ build.commit }}|{{ truncate build.commit 8 }}>
        Tags: <https://github.com/{{ repo.owner }}/{{ repo.name }}/tree/{{ build.tag }}|{{ build.tag }}>
        Branch: {{ build.branch }}
        Author: {{ build.author }}
        Link:  <{{ build.link }}|Visit build page ↗>
    when:
      status: [ success, failure ]
#    commands:
#      - echo hello
trigger:
  event:
    - push
